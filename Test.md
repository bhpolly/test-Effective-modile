# Тестовое задание

## Задание 1: Анализ требований
_Описание: Вам попал на руки фрагмент технического задания на разработку функционала "Корзина" для интернет-магазина "Петрушка Зеленая". В ТЗ есть несколько логических противоречий, недочетов и неполных мест._

_Что нужно сделать:_   
_1. Найдите и перечислите все логические противоречия и недочеты в предоставленном ТЗ. Объясните, в чем заключается проблема для каждого пункта._   
_2. Предложите конкретные исправления для устранения этих противоречий - напишите свою версию этого фрагмента ТЗ, которая должна быть логически завершенной и непротиворечивой._   
_3. Какие уточняющие вопросы вы бы задали продукт-менеджеру или бизнес-заказчику по этому ТЗ?_   


### Раздел ТЗ: Функционал корзины
Исходные требования задания: 
1. Пользователь может добавить в корзину от 1 до 10 единиц одного товара.
2. Пользователь может изменить количество каждого товара в корзине не менее, чем до 1-го. Для удаления товара из корзины используется отдельная кнопка.
3. В корзине может находиться не более 5 различных товаров.
4. Суммарное количество всех товаров в корзине не может превышать 20 штук.
5. Товары в корзине могут быть разные.
6. При попытке добавить товар, превышающий лимиты, система показывает сообщение: "Лимит корзины превышен".
7. Цена на продукт фиксируется на момент добавления в корзину и не меняется.
8. На странице корзины отображается список товаров, их количество, цена за единицу и общая стоимость позиции.
9. Если пользователь уменьшает количество товара до 0, товар удаляется из корзины.
10. В корзине может быть реклама других продуктов.
11. Реклама товаров в корзине должна быть каждый будний день по утрам и вечерам.
12. Если цена на товар изменилась в каталоге, система должна автоматически обновить ее в корзине у всех пользователей.

### Разбор требований 
1. Недочет п.1, п.3 и п.4. 
*"1. Пользователь может добавить в корзину от 1 до 10 единиц одного товара. 3. В корзине может находиться не более 5 различных товаров. 4. Суммарное количество всех товаров в корзине не может превышать 20 штук."*   
**Проблема**: Недостаточно согласованные ограничения. Например, если добавить 5 товаров по 4 штуки (итого 20) — нормально. Но если добавить 5 товаров по 5 штук — нарушится п.4, а если добавить 6 товаров по 1 штуке — нарушится п.3. Неясно, какое ограничение приоритетнее.   
**Вариант исправления**: Возможные варианты исправления предлагаются по результатам уточнения требований с бизнесом. Например, можем прибегнуть к приоритету при проверке, т.е. сначала проверяется лимит уникальных товаров (5), затем общее количество (20).
   
2. Противоречие п.2 и п.9.   
*"2. Пользователь может изменить количество каждого товара в корзине не менее, чем до 1-го. Для удаления товара из корзины используется отдельная кнопка. 9. Если пользователь уменьшает количество товара до 0, товар удаляется из корзины."*   
**Проблема**: Два взаимоисключающих механизма удаления.   
**Вариант исправления**: Возможные варианты исправления предлагаются по результатам уточнения требований с бизнесом. Для финального примера допустим, что для удаления товара используется только отдельная кнопка, а минимальное количество единиц товара - 1.
   
3. Недочет п.2.    
*"Пользователь может изменить количество каждого товара в корзине не менее, чем до 1-го. Для удаления товара из корзины используется отдельная кнопка."*   
**Проблема**: В одному пункте смешено два функциональных возможности: редактирование количества товара и удаление его из корзины. К тому же, формулировка "не менее, чем до 1-го" неточная. Не хватает информации о процессе удаления товара из корзины.   
**Вариант исправления**: *"2. Пользователь может увеличивать или уменьшать количество каждого товара в корзине. Минимальное количество товара в корзине — 1 единица. 3. Пользователь может удалить товар из корзины путем нажатия на кнопку "Удалить" (см. макет). В случае, если количество единиц товара в корзине больше 1, то при нажатии на кнопку "Удалить" товар удаляется из корзины целиком."*
   
4. Недочет п.5.   
*"Товары в корзине могут быть разные."*   
**Проблема**: это очевидное следствие возможности добавлять разные товары, не несет полезной информации. 
**Вариант исправления**: _"В корзину можно добавлять товары с разными артикулами (SKU)."_

5. Недочет п.6.    
*"При попытке добавить товар, превышающий лимиты, система показывает сообщение: "Лимит корзины превышен"."*
**Проблема**: Непонятно, что подразумевается под "товаров, привышающим лимиты". Не указано, что происходит при попытке добавить товар сверх лимита — товар не добавляется совсем или добавляется до максимально возможного количества?
**Вариант исправления**: _"При попытке добавить товар, превышающий лимиты корзины (см. п.2), система показывает сообщение: "Лимит корзины превышен". Товар не добавляется в корзину при превышении лимитов."_

6. Противоречие п.7 и п.12   
*"7. Цена на продукт фиксируется на момент добавления в корзину и не меняется. 13. Если цена на товар изменилась в каталоге, система должна автоматически обновить ее в корзине у всех пользователей."*
**Проблема**: противоречие в логике ценообразования
**Вариант исправления**: Возможные варианты исправления предлагаются по результатам уточнения требований с бизнесом. Допустим следующий вариант: цена товара фиксируется на момент добавления в корзину и не изменяется в течение сессии. При оформлении заказа система проверяет актуальность цен и при необходимости запрашивает подтверждение изменений у пользователя.
   
7. Недочет п.8.   
*"На странице корзины отображается список товаров, их количество, цена за единицу и общая стоимость позиции."*
**Проблема**: Не понятно, что конкретно подразумевается под "их количество". Нет ссылки на макет (непонятно, как это будет выглядеть).   
**Вариант исправления**: *"На странице корзины отображается список товаров, количество единиц товара с возможностью изменения, цена за единицу и общая стоимость позиции (см. бизнес правило "Расчет общей стоимости позиции")."* 
   
8. Недочет п.10. и п.11    
*"10. В корзине может быть реклама других продуктов. 11. Реклама товаров в корзине должна быть каждый будний день по утрам и вечерам"*
**Проблема**: Это требование к контент-менеджменту или расписанию, а не к функционалу корзины. Технически неясно, что значит "по утрам и вечерам" — в каких часовых поясах, для каких пользователей.
**Вариант исправления**: Выделить данную фичу в отдельный документ требований, связанный с рекламой в приложении. Доуточнить требования и процессы. Допустим, что отдельно уже описаны требования к рекламному блоку.   

### Примерный вариант требований с учетом исправлений (необходимо уточнение у бизнеса):
1. Пользователь может добавить в корзину от 1 до 10 единиц одного товара за одну операцию. В корзину можно добавлять товары с разными артикулами (SKU).
2. При достижении максимального (10) (или минимального (1)) количества единиц товара в корзине кнопка "Добавить" (или "Удалить") деактивируется. 
3. В корзине может находиться не более 5 различных товаров (уникальных SKU). Суммарное количество всех товаров в корзине не может превышать 20 единиц. Приоритет при проверке: сначала проверяется лимит уникальных товаров (5), затем общее количество (20). При нарушении любого из них добавление не происходит.
4. Пользователь может увеличивать или уменьшать количество каждого товара в корзине. Минимальное количество товара в корзине — 1 единица. 
5. Пользователь может удалить товар из корзины путем нажатия на кнопку "Удалить" (см. макет). В случае, если количество единиц товара в корзине больше 1, то при нажатии на кнопку "Удалить" товар удаляется из корзины целиком, независимо от текущего количества.
6. Цена товара фиксируется на момент добавления в корзину и не изменяется в течение сессии. При оформлении заказа система проверяет актуальность цен и при необходимости запрашивает подтверждение изменений у пользователя.
7. На странице корзины отображается (см. макет):
- Список товаров с изображениями
- Название каждого товара
- Количество единиц товара с возможностью изменения
- Цена за единицу
- Общая стоимость позиции (см. бизнес правило "Расчет общей стоимости позиции")
- Итоговая сумма заказа
8. Под списком товаров может отображаться блок с рекомендованными товарами (рекламный блок).
9. При попытке добавить товар, превышающий лимиты корзины (см. п.3), система показывает сообщение: "Лимит корзины превышен". Товар не добавляется в корзину при превышении лимитов. (*комментарий: необходимо доработать логику лимитов добавления товаров*)
 
### Уточняющие вопросы (продукт-менеджеру или бизнес-заказчику): 
1. Какой лимит приоритетнее: количество уникальных товаров (5) или общее количество единиц (20)? Что должно происходить, если оба лимита могут быть соблюдены по отдельности, но не вместе? (см. разбор требований п.1)
2. Что важнее для бизнеса: фиксация цены на момент добавления в корзину (для уверенности покупателя) или актуальность цены (чтобы избежать потерь при изменении стоимости)? Как обрабатывать ситуацию, когда цена изменилась в момент оформления заказа? (см. разбор требований п.6)
3. Можно ли оформить заказ только на часть товаров из корзины? Или заказ всегда создается на всю корзину целиком?
4. Что поисходит с товарами в корзине после оформления заказа?
5. Как обрабатывать ситуацию, когда товар, добавленный в корзину пользователя, стал недоступен (например, раскуплен)? Как обрабатывать ситуацию, когда товар стал недоступен в процессе оформления заказа (например, в процессе оплаты)? Нужно ли резервировать товар при добавлении в корзину или только при оформлении заказа?
6. Каждый пользователь имеет только одну корзину, в которую он может добавлять товары? 
7. Доступ к корзине имеют только зарегистрированные пользователи? Если нет, то должен ли быть механизм сохранения корзины между сессиями для незарегистрированных пользователей (в cookies/localStorage)?
8. Если корзина пуста, что будет видно пользователю? Например, "Корзина пуста" или кнопка "Перейти в каталог"?
9. Какой вариант удаления товара из корзины будет корректнее: ля удаления товара используется только отдельная кнопка и минимальное количество единиц товара - 1 или можем уменьшить количество товара до 0 и таким образом удалить товар из корзины (см. разбор требований п.2)? 
10. При нажатии на кнопку "Удалить" мы подразумеваем полное удаление всех единиц товара определенного вида (с определенным артикулом) или это возможно только в случае, когда количество единиц товара равно 1 (см. разбор требований п.3)?
11. Должна ли корзина отображать стоимость доставки сразу или только на этапе оформления? (см. разбор требований п.7)

### Дополнительные возможные вопросы: 
1.  Если у товара есть выбор атрибутов (размер, цвет), можно ли изменить уже выбранный атрибут прямо в корзине, или нужно удалить товар и добавить заново с новыми параметрами?
2. Необходимо ли к каждому товару показывать его изображение? 
3. Нужна ли интеграция корзины с системами лояльности или промокодами?
4. Нужна ли возможность отключения рекламного блока для пользователей?
5. Нужен ли в корзине калькулятор или приблизительная оценка стоимости доставки? Или это шаг только в процессе оформления?


## Задание 2: проектирование API
_Описание: интернет-магазин "Петрушка Зеленая" преуспевает, расширяется и в мобильном приложении решили создать новый экран, который будет отображать магазины партнеров (см. макеты ниже)._   
_Что нужно сделать: Написать пример REST API запроса, который будет вызываться при переходе пользователя на данный экран. Привести пример ответа этого REST API в соответствии с макетом. Формат - JSON. Учесть, что при клике на плашку магазина должен осуществляться переход по ссылке на внешний ресурс._


| Метод | Описание | URL | Тело запроса | Тело ответа | Статусы ответов | Идемпотентность |
| --- | --- | --- | --- | --- | --- | --- |
| GET | Получение списка компаний | api/v1/partners | - | см. пример ниже | 200 ОК   404 Not Found   403 Forbidden   401 Unauthorized | Да |

### Стартовая строка запроса
GET api/v1/partners HTTP/1.1  
### Заголовки запроса  
Authorization: _{access_token}_   
Сontent-type: _application/json_   
User-Agent: _Mozilla/5.0 (iPhone; CPU iPhone OS 14_4 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.0.3 Mobile/15E148 Safari/604.1  (пример)_   
App-Version: _1.2.0 (пример)_   
Cache-Control: 
### Параметры запроса
| Параметр | Значения |
| --- | --- |
| offset | 1 |
| limit | 20 |

### Тело ответа (200 OK)
```
200 OK
{
   "companies": [
      {'companyId": 12387,
      "companyName": "METRO",
      "companyLogo": "https://cdn.petrushka.ru/partners/metro.png",
      "companyUrl": "https://metro-cc.ru/markets",
      "fastDelivery": False, 
      "nearestDeliveryStart": "2026-02-10T21:00:00Z",
      "nearestDeliveryEnd": "2026-02-10T23:00:00Z"},
      {'companyId": 15629,
      "companyName": "Ашан",
      "companyLogo": "https://cdn.petrushka.ru/partners/ashan.png",
      "companyUrl": "https://www.auchan.ru",
      "fastDelivery": False, 
      "nearestDeliveryStart": "2026-02-10T18:00:00Z",
      "nearestDeliveryEnd": "2026-02-10T20:00:00Z"},
      {'companyId": 12387,
      "companyName": "ВкусВилл",
      "companyLogo": "https://cdn.petrushka.ru/partners/vkusvill.png",
      "companyUrl": "https://vkusvill.ru",
      "fastDelivery": True,
      "fastDeliveryTimeMin": 20,
      "fastDeliveryTimeMax": 60},
      {'companyId": 12387,
      "companyName": "ВИКТОРИЯ",
      "companyLogo": "https://cdn.petrushka.ru/partners/victoria.png",
      "companyUrl": "https://victoria-group.ru",
      "fastDelivery": False,
      "nearestDeliveryStart": "2026-02-10T17:00:00Z",
      "nearestDeliveryEnd": "2026-02-10T19:00:00Z"}]
}
```
### Тело ответа (404 Not Found)
```
404 Not Found
{
   "message": "Ресурс не найден"
}
```
### Тело ответа (403 Forbidden)
```
403 Forbidden
{
   "message": "Недостаточно прав"
}
```
### Тело ответа (401 Unauthorized)
```
401 Unauthorized
{
   "message": "Отстутсвует токен авторизации",
   "userMessage": "Необходимо авторизоваться"
}
```

## Задание 3: архитектура

_Описание: Заказчик хочет, что в мобильное приложение интернет-магазина "Петрушка Зеленая" начали приходить пуши. Они могут быть разными: о том, что заказ слишком долго лежит без действий в корзине, об отмене заказа, рекламные рассылки и прочее. То есть нужен функционал, а какие пуши отправлять - точно найдется._

_Что нужно сделать: Построить верхнеуровневую архитектурую схему - как должна работать отправка PUSH уведомлений в данном приложении. Можно просто в виде блок схем. Считаем, что на бэкенде микросервисная архитектура. В данном задании рекомендуется в интернете изучить архитектуры подобных решений.
Быть готовым на собеседовании обсудить эту схему._

### Реализация  
В первую очередь, на уровне бизнес-аналитики нам нужно определится:
- какие события происходят в системе, которые будут триггерить отправку сообщений
- кто получатель уведомления (все пользователи, конкретная категория, персонализированная отправка)
- какую инфрмацию должно содержать push-уведомление (заголовок, текст)
- куда перенаправляем пользователя при нажатии на уведомление
- будем ли хранить информацию о уведомлении в системе (необходимо ли пользователю иметь доступ к старым уведомлениям?)

Вопросы: 
- для каждого события необходим свой тип уведомлений?
- для каких операционных систем необходимо проектировать push-уведомления (у каждой ОС свои типы уведомлений)?
- где хранить метаинформацию по уведомлению (тип, текст, заголовок, получателей и т.д.)?
- где и в каком виде хранить информацию о перенаправлении?
- какая бизнес-логика работы приложения (бизнес-процессы, макеты UX/UI)?
- какая ролевая модель (для каждого типа пользователей свои уведомления)?

Для отправки push-уведомлений используются сервис Firebase Cloud Messaging (FCM) -- push provider. 

Верхнеуровневая архитектура мобильного приложения интернет-магазина "Петрушка Зеленая":
<img width="1591" height="761" alt="image" src="https://github.com/user-attachments/assets/e8260471-6b3f-483f-9b7c-b3d83257c250" />

Пример формирования push-уведомления (успешный процесс отмены заказа):
<img width="1859" height="748" alt="image" src="https://github.com/user-attachments/assets/f9c1fa8f-0d33-4b90-af68-322875d83df2" />








